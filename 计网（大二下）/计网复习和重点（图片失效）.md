一、计算机网络概述

1. 网络发展历史、网络的定义、分类和组成、

2. 网络协议分层模型介绍（OSI和TCP/IP模型的比较）

重点：网络协议的概念、分层

* 分层的目的：降低复杂性
* 分层的好处和坏处：好处是设计简答，坏处是速度性能（整体优化的优点是速度快，但是缺点是设计复杂和耦合性强）
* 跨层：NAT为了解决IP的映射，引入了传输层的端口概念
* 协议和服务的概念
* 每层的物理设备
* 每层的功能

二、数据通信基础与物理层

1. 信道的基本特征，信道容量、传输速率的概念；

2. 有线、无线传输介质及其特性；

3. 电话网结构与ADSL接口；

4. 交换技术(电路交换、分组交换技术的区别)

5. 多路复用技术（频分复用、时分复用、码分复用）

6. 同步光纤网和无线电话网中的多路复用技术

重点：**信道容量**的概念、**分组交换**技术、**多种复用**技术的应用

* 信息量、信息熵的计算
* 两个公式计速率
* 基带传输（RZ、NRZ、NRZI、曼切斯特码），数字0101的传输
* 频带传输（ASK、FSK、PSK、QAM），调制后的模拟信号传输
* 信道复用技术，针对光纤的光波复用
* 信道介质
* 三种交换方式（分组交换可以实现准实时通信，报文交换不行）- 考大题

三、数据链路层协议

1. 成帧的多种方法

2. 差错检测码（循环冗余码的检错原理）

3. 滑动窗口协议原理（解释窗口大小对协议效率的影响，滑动窗口）

4. 数据链路层协议标准HDLC、Internet中的链路层

重点：滑动窗口协议

* 有难题！！
* 帧的定界方法
* 检错纠错（**CRC检错、海明码纠错**）
* 滑动窗口三个协议
* * 窗口大小（回退N帧n-1，选择重传n-n，接收方缓存管理能力和传输能力的平衡）
  * **计算停等协议的发送效率**

四、介质访问控制子层

1. 介质访问避免碰撞的基本技术及其特点（完全竞争、部分竞争、预约）

2. CSMA_CD与以太网工作原理

3. 高速局域网

4. 数据链路层交换--网桥和交换机工作的基本原理

5. 无线网络的介质访问控制

重点：避免冲突的策略、网桥和交换机的自学习功能

* 分配方式：静态、动态（冲突、无冲突、竞争）
* CSMA的三种方式（信道忙是继续侦听、随机侦听、概率p的持续侦听）
* **最小帧长计算**：2t发送的帧长=最小帧长
* 以太网名称和传输介质、拓扑结构（10baseT）
* MAC帧的格式，目的地址和源地址是怎么表示的，每个部分都是多少位、填充位是怎么计算的，校验的是什么
* * http://www.javashuo.com/article/p-pkmrwilv-mu.html

五、网络层

1. 网络层的不同实现技术（数据报与虚电路）

2. 网络路由算法(链路状态和距离矢量)

3. 网络拥塞控制算法（网络流量整形的方法、网络拥塞反馈的方法）

4. IP协议与IP地址、IP寻址方式、子网掩码、无类域间路由、

5. ICMP报文与地址解析协议ARP

重点：网络路由算法和拥塞控制算法、IP寻址

* 距离矢量、链路状态、路径向量
* * 基本过程
  * 工作原理
  * **计算表项**
* IP子网划分
* CIDR 提高IP利用率
* NAT 控制路由表大小
* **子网划分和子网掩码计算**（PPT上有例题）
* ARP、DHCP、**ICMP**
  * 基本原理和作用x
* **路由表的计算**
* 组播和ipv6不考

六、传输层

1. 基本问题与技术（端口的概念）

2. TCP协议与UDP协议

3. **TCP拥塞控制策略**

4. Socket编程技术

重点: TCP协议的拥塞控制方法

* TCP的基本格式
* TCP三次、四次握手的过程
* 新的RTT的估算
* **流量整形计算（漏桶和令牌桶计算，PPT上例子）**
* **阻塞控制的计算**

七、应用层

1. 多种应用层协议的工作原理，Web网络的组成和HTTP协议；邮件传输协议SMTP与邮件系统；域名系统DNS；文件传输协议FTP。

2. 网络安全基本技术（加密、认证、数字签名的基本概念和使用场景）

* **DNS、HTTP的基本过程**是重点

* 其他的就知道了解概念即可



* **地址空间的管理**，**路由表、网桥表**、RIP、OSPF计算
* **拥塞控制**
* **漏桶令牌桶调节计算**
* **速率的计算**



# 表table-查找

数据链路层：网桥表、透明网桥的工作原理、自学习过程、表项中的Time生存时间

网络层：路由表、虚电路表、ARP表、NAT转换表

应用层：DNS转换表





# 计时器Timer-源于未知

所有表中都有Timer信息，代表表项存在的时间

发送方TimeOut，解决包丢失，传输层TCP计算TimeOut

传输层：发送方的定时器，解决0窗口问题

多章结合，综合**分析**

**计算**问题，如何划分子网，如何配置路由器

![img](https://img-my.csdn.net/uploads/201304/16/1366100130_5972.jpg)





# 报文格式

1. 有报文中有总长度的只有IP头和UDP头

* **数据长度 = IP报文总长度-IP头 = UDP报文总长度 - 8B**

2. 有报头长度有IP头、TCP头

3. 头部开销：（B）
   * IP ：20-60
   * TCP：20-60
   * UDP：8
   * MAC：26

4. TCP端口：2B

   IP：4B

   MAC：6B

## HTTP报文

![image-20220613212738726](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613212738726.png)

## TCP报文

* 固定长度：20B
* 4的整数倍

![image-20220613204232328](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613204232328.png)



### 序号字段的理解

* TCP报头后面跟了一串字节，每个字节都有编号，TCP报头中存放的是第一个字节的编号

![image-20220613204630811](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613204630811.png)



### 确认号字段

* 反映的是期望收到下一个报文段的数据的第一个字节的序号

![image-20220613204944144](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613204944144.png)



### 数据偏移

* 标志首部长度
* 最大60B

![image-20220613205104846](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613205104846.png)

### 标志位

* 建立连接和响应建立：SYN=1
* 建立连接之后：ACK=1
* 释放连接：FIN=1

![image-20220613205519374](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613205519374.png)



### 校验字段

* 检验数据和首部
* UDP，17
* TCP，6

![image-20220613205639275](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613205639275.png)



## UDP报文

![image-20220613205728830](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613205728830.png)

### 校验

* 伪首部：IP+协议17

![image-20220613210052571](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613210052571.png)

* 校验和填入0
* 数据填充0补全16位
* 求和、取反得到校验和
* 校验和本质就是和其他数据相加等于0，如果不等于0就代表出错，奇偶校验。



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613210136888.png" alt="image-20220613210136888" style="zoom:80%;" />



## IP报文

* **固定长度20B**
* **最大长度60B**
* 三个长度信息：**1B，4B，8B=总长度，首部，偏移**
* * 首部长度：20-60，**单位是4B**
  * 总长度：首部+数据，最大65535，**单位是1B**；以太网MTU=1500，要保证IP长度不长于MTU，因此要分片
  * 片偏移：分片后每个分片在原来报文中的偏移位置，**单位是8B**
* 三个和分片有关的信息：**当总长度大于以太网MTU=1500B时需要分片**
* * 标识：同一个IP报文的不同分片有相同的标识
  * 标志：最后一位MF=1后面还有分片、MF=0后面没有分片；第二位DF=0允许分片、DF=1不允许分片（UDP就不分片）
  * 片偏移
* 路由相关的：TTL，没过一个路由器就减一
* 和填充相关的：**当总长度不满足以太网最小帧长46B时要进行填充**
* **IP的首部校验和只校验IP首部，不包含数据**

![image-20220613210925139](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613210925139.png)



## MAC帧

* CRC校验的是除了前导码的所有，地址+类型+数据
* **数据大小受MTU和CSMA/CD的限制**
* **帧大小（不包含前导码）：64-1518**
* **有效数据：46-1500B**
* 控制部分：18B
* 前导码：8B

![image-20220613212020731](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613212020731.png)



## HDLC帧*

![image-20220613212446031](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220613212446031.png)





# 各种指标

### 性能指标 ###

> 性能指标可以从不同的方面来度量计算机网络的性能

#### 1. 速率 ####

> 连接在计算机网络上的主机在数字信道上传送比特的速率，也称为比特率或数据率

**常用数据率单位**
$$
bit/s可缩写为b/s或bps\\1\ kb/s=10^{3}\ b/s\\1\ Mb/s=10^{6}\ b/s\\1\ Gb/s=10^{9}\ b/s\\1\ Tb/s=10^{12}\ b/s\\
$$

##### **比特** #####

> 计算机中的数据量单位，也是信息论中信息量的单位。一个比特就是二进制数字中的一个`1`或`0`.

**常用数据量**

<img src="https://s2.loli.net/2022/03/29/dDJP5qT3y1WC26B.png" alt="image-20220329154706248" style="zoom:67%;" />

#### 2. 带宽 ####

**带宽在计算机网络中的意义**

> 用来表示网络的**通信线路**所能传送数据的能力，因此网络带宽表示在单位时间内从网络中的某一点到另一点所能通过的"最高数据量"
>
> 单位：`b/s（kb/s，Mb/s，Gb/s，Tb/s）`

**一条通信线路的"频带宽度"越宽，其所传输数据的"最高数据率"也越高**

#### 3. 吞吐量 ####

> 吞吐量表示在**单位时间内通过某个网络(或信道、接口)的数据量。<br>**吞吐量被经常用于对现实世界中的网络的一种测量，以便知道实际上到底有多少数据量能够通过网络。<br>吞吐量**受网络的带宽或额定速率的限制**

#### ★线路效率

线路效率 = 吞吐率/带宽

#### 4. ★时延

> 在处理过程中所需要的时间

<img src="https://s2.loli.net/2022/03/29/aVo5qz8T2ALPpsm.png" alt="image-20210122211654475" style="zoom:50%;" />

<img src="https://s2.loli.net/2022/03/29/Obtw1ysZp9aHWfR.png" alt="image-20210201213615002" style="zoom: 50%;" />

#### 5. 时延带宽积 ####

<img src="https://s2.loli.net/2022/03/29/lHseOxXwYITAuLz.png" alt="image-20210122211936217" style="zoom:50%;" />

#### 6. 往返时间 ####

> 在许多情况下，因特网上的信息不仅仅单方向传输，而是双向交互<br>我们有时很需要知道双向交互一次所需要的时间<br>因此，往返时间`RTT(Round-Trip Time)`也是一个重要的性能指标

#### 7. ★利用率 ####

> **信道利用率**：用来表示某信道有百分之几的时间是被利用的(有数据通过)<br>**网络利用率**：全网络的信道利用率的加权平均

+ 根据排队论，当某信道的利用率增大时，该信道引起的时延也会迅速增加。因此**信道利用率不是越高越好**

+ 如果令**$D_0$表示网络空闲时的时延**，**D表示网络当前的时延**，那么在适当的假定条件下，可以用下面的简单公式来表示`D`、$D_0$和**利用率U**之间的关系

  ​																			$D=\dfrac{D_0}{1-U}$

  <img src="https://s2.loli.net/2022/03/29/KyvCpe8fkm9IoG1.png" alt="image-20210122213806619" style="zoom:50%;" />

  当网络利用率`U`到`50%`时，时延急剧增大。

  当网络利用率接近`100%`时，时延趋于无穷大

  但是也不能使信道利用率过低，这回使宝贵的通信资源被浪费

因此一些拥有较大主干网的`ISP`通常会控制它们的信道利用率不超过`50%`。如果超过了，就要准备扩容，增大线路带宽

#### 8. 丢包率 ####

> 丢包率即分组丢失率，是指在一定的时间范围内，传输过程中**丢失的分组数量与总分组数量的比率**<br>具体可分为：接口丢包率、结点丢包率、链路丢包率、路径丢包率、网络丢包率等

**`丢包率是网络运维人员非常关心的一个网络性能指标，但对于普通用户来说往往并不关心这个指标，因为他们意识不到丢包`**

**分组丢失的两种情况**

+ 分组在传输过程中出现误码，被结点丢弃
+ 分组到达一台队列已满的分组交换机时被丢弃，在通信量较大时就可能造成网络拥塞

**丢包率反映了网络的拥塞情况**

+ **无拥塞**时路径丢包率为`0`
+ 轻度拥塞时路径丢包率为`1%~4%`
+ **严重拥塞**时路径丢包率为`5%~15%`



# 各层设备和协议概述

物理层:(典型设备：**中继器，集线器**、网线、HUB)              数据单元：比特 （Bit） 

以太网物理层、调制解调器、PLC 、SONET/SDH 、G.709 、**光导纤维**、 **同轴电缆、双绞线**





数据链路层: (典型设备:  **网卡，网桥，交换机**)       数据单元：帧 （Frame） 

**ARQ**（Automatic Repeat-reQuest ）自动重传请求协议，错误纠正协议之一，包括停止等待ARQ 协议和连续ARQ 协议，错误侦测、正面确认、逾时重传与负面确认继以重传等机制。 

 停止等待协议： 
 **CSMA/CD**(Carrrier Sense Multiple Access with Collision Detection)载波监听多点接入/碰撞检测协议。总线型网络，协议的实质是载波监听和碰撞检测。载波监听即发数据前先检测总线上是否有其他计算机在发送数据，如暂时不发数据，避免碰撞。碰撞检测为计算机边发送数据边检测信道上的信号电压大小。 

**PPP**(Point-to-Ponit Protocol)点对点协议面向字节，由三部分组成：一个将IP 数据报封装到串行链路的方法；一个用于建立、配置和测试数据链路连接的链路控制协议

LCP(Link Control Protocol) ：一套网络控制协议NCP 。 

**HDLC**  （High-Level Data Link Control ）高级数据链路控制同步网上传输数据、面向比特的数据链路层协议。 

 ATM  （Asynchronous Transfer Mode ）异步传递方式，建立在电路交换和分组交换的基础上的一种面向连接的快速分组交换技术。 “异步”是指将ATM 信元“异步插入”到同步的 SDH 比特流中。如同步插入则用户在每帧中所占的时隙相对位置固定不变。“同步”是指网络中各链路上的比特流都是受同一非常精确的主时钟的控制。Wi-Fi 、WiMAX 、DTM 、令牌环、以太网、FDDI 、帧中继、 GPRS 、 EVDO 、HSPA 、L2TP 、ISDN 



网络层: (典型设备:**路由器**，防火墙、多层交换机) 数据单元：**数据报、分组**

 **IP (IPv4 · IPv6)** (Internet Protocol) 网络之间互连的协议 

**ARP** (Address Resolution Protocol) 即地址解析协议，实现通过IP 地址得 知其物理地址。 

RARP (Reverse Address Resolution Protocol)反向地址转换协议允许局域 网的物理机器从网关服务器的 ARP 表或者缓存上请求其 IP地址。 

 **ICMP** (Internet Control Message Protocol ）Internet 控制报文协议。它是TCP/IP 协议族的一个子协议，用于在IP 主机、路由器之间传递控制消息。 

ICMPv6 : 

 IGMP (Internet Group Management Protocol) Internet 组管理协议,是因特 网协议家族中的一个组播协议，用于 IP  主机向任一个直接相邻的路由器报 告他们的组成员情况。 

 

**OSPF** (Open Shortest Path Firs)开放式最短路径优先,分布式链路状态协议。 





传输层:  (典型设备:  网关、**进程和端口**)    数据单元：**报文 （Segment）** 

 **TCP**  （Transmission Control Protocol ）传输控制协议提供可靠的面向连接的服务，传输数据前须先建立连接，结束后释放。**可靠的全双工信道**。可靠、有序、无丢失、不重复。 

 **UDP** (User Datagram Protocol ）用户数据报协议发送数据前无需建立连接，不使用拥塞控制，不保证可靠交付，最大努力交付。 

 DCCP   （Datagram Congestion Control Protocol ）数据报拥塞控制协议 

 SCTP  （STREAM CONTROL TRANSMISSION PROTOCOL ）流控制传 输协议 

RTP(Real-time Transport Protocol ）实时传送协议 

 RSVP  （Resource ReSer Vation Protocol ）资源预留协议 

 PPTP ( Point to Point Tunneling Protocol ）点对点隧道协议 



应用层: (典型设备:**应用**程序，如FTP，SMTP ，HTTP) 

**RIP** (Router information protocol) 路由信息协议是一种在网关与主机之间交换路由选择信息的标准。 UDP

 **BGP**（Border Gateway Protocol ）边界网关协议，用来连接Internet 上独立系统的路由选择协议.采用**路径向量**路由选择协议。 TCP

 IS-IS （Intermediate System to Intermediate System Routing Protocol ）中间系统到中间系统的路由选择协议. 

 IPsec (IP Secure) “Internet  协议安全性”是一种开放标准的框架结构，通过使用加密的安全服务以确保在 Internet  协议 (IP)  网络上进行保密而安全的通讯。 

**DNS** 解析域名到IP
**DHCP**(Dynamic Host Configuration Protocol)动态主机分配协议，使用 UDP 协议工作，主要有两个用途：给内部网络或网络服务供应商自动分配 IP 地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。实 现即插即用连网。 

BOOTP (BOOTstrapProtocol) 引导程序协议/ 自举协议，使用UDP 来使 一个无盘工作站自动获取配置信息。静态的配置协议 DNS   （Domain Name System ）域名解析<端口号53> 

**FTP**  （File Transfer Protocol ）文件传输协议<**端口号21**>减少或消除不同操作系统下处理文件的不兼容性。 

Gopher  （The Internet Gopher Protocol ）网际Gopher 协议 

**HTTP**   （Hypertext Transfer Protocol ）超文本传输协议 <**端口号 80**>， 面向事务的应用层协议。 

IMAP4 (Internet Message Access Protocol 4) Internet 信息访问协议的第 4 版本 

IRC  （Internet Relay Chat ）网络聊天协议 

NNTP   （Network News Transport Protocol ）网络新闻传输协议 

XMPP 可扩展消息处理现场协议 

**POP3** (Post Office Protocol 3) 即邮局协议的第3 个版本，用于接受邮件。 

SIP()信令控制协议 

**SMTP** （Simple Mail Transfer Protocol ）简单邮件传输协议 <**端口号25**> 用于发送邮件。 
SNMP (Simple Network Management Protocol),简单网络管理协议 

SSH  （Secure Shell ）安全外壳协议 

**TELNET**   远程登录协议 <端口号23> 

RPC  （Remote Procedure Call Protocol ）（RFC- 1831）远程过程调用协 议 

RTCP   （RTP Control Protocol ）RTP  控制协议 

RTSP  （Real Time Streaming Protocol ）实时流传输协议 

TLS  （Transport Layer Security Protocol ）安全传输层协议 

SDP( Session Description Protocol ）会话描述协议 

SOAP  （Simple Object Access Protocol ）简单对象访问协议 

GTP 通用数据传输平台 

STUN  （Simple Traversal of UDP over NATs ，NAT    的UDP 简单穿越） 是一种网络协议 

 NTP  （Network Time Protocol ）网络校时协议。 







# 第一章

1.对等实体、协议、服务

对等实体：同一层上能够相互通信的设备、进程

协议：控制对等实体之间通信的规则，是水平的。

服务：下层通过层间接口向上层提供的功能，是垂直的。



2、分组交换时延的定义应该是最后的比特从离开发送端开始到到达接收端为止的时间，下来我们通过一个例子来说明一下： 

题目： 要传送的报文共 x（bit），从原点到终点共经过 k 段链路，每段链路的传播时延为 d（s），数据率为 b（bit/s），分组交换时分组长度为 p（bit），求分组交换的时延。 

分析一下： 最后的比特离开发送端的时延 x/b 最后的比特**传播时延** kd 最后的比特经过中途路由器所需要的的时延 （k-1）p / b 将最后一个比特所有的时延加起来就是分组交换的总时延，即： x/b + kd +（k-1）p / b

* 分组交换计算最后一组什么时候传输完毕是应该先算有几组，再算每一组的传输时延：x/p * p/b = x/b； **x/p * (p+r)/b 这是增加了r的控制头以后的**。



3.各个层之间的差错控制

![image-20220601145729880](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220601145729880.png)



4.各个层的数据名称：

物理层： bit

链路层：帧

网络层：**分组**、数据包

传输层：**报文段**



5.OSI模型各层主要功能：

1.物理层：透明的比特流传输

2.链路层：点到点。封装成帧、超时重传、流量控制、差错检验

3.网络层：**面向连接、无连接**。**网际互联**、流量控制、拥塞控制、差错控制

4.传输层：**端到端面向连接可靠传输**。流量控制、差错控制

5.会话层：会话建立、维持、终止；**从校验点恢复通信**

6.表示层：两个不同系统间交换信息。压缩、编码、加密解密

7.应用层：接口面向用户界面

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220601150915451.png" alt="image-20220601150915451" style="zoom:50%;" />

6.OSI和TCP/IP的差异

* OSI追求统一兼容和完美，难以实现
* TCP/IP不适用于其他非TCP/IP协议的网络体系
* OSI网络层提供面向连接和无连接，传输层只有面向连接；TCP/IP网络层提供面向无连接，传输层提供面向连接和无连接
* 折中：5层模型





# 第二章

1.

![image-20220605170416547](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605170416547.png)

2.

![image-20220605170622936](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605170622936.png)



3.

![image-20220605171043988](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605171043988.png)



4.

![image-20220605172337009](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605172337009.png)



5.

![image-20220605172423035](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605172423035.png)

6.

![image-20220605172529618](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605172529618.png)

7.

![image-20220605172943633](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605172943633.png)



8.

分组交换是一个统称，只有里面的数据报服务才是存储转发的。

![image-20220605173044133](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173044133.png)

![image-20220605173100651](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173100651.png)

9.

![image-20220605173235732](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173235732.png)

10.

![image-20220605173356587](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173356587.png)



11.

![image-20220605174548473](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605174548473.png)

12.

![image-20220605175529365](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605175529365.png)

13.

![image-20220605175537785](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605175537785.png)



10baset

![image-20220606165835610](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606165835610.png)



![image-20220606165857994](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606165857994.png)





## 同步和异步

* **同步：比特、帧；快速；连续**
* **异步：字符、字节；开销大；随机**

1. 异步传输（Asynchronous Transmission）：异步传输模式(Asynchronous Transfer Mode,缩略语为ATM)
异步传输一般以字符为单位，
起始位：先发出一个逻辑”0”信号，表示传输字符的开始。
空闲位：处于逻辑“1”状态，表示当前线路上没有资料传送。

 异步传输将比特分成小组进行传送，小组可以是8位的1个字符或更长。发送方可以在任何时刻发送这些比特组，
而接收方从不知道它们会在什么时候到达。一个常见的例子是计算机键盘与主机的通信。按下一个字母键、数字键或特殊字符键，就发送一个8比特位的ASCII代码。
键盘可以在任何时刻发送代码，这取决于用户的输入速度，内部的硬件必须能够在任何时刻接收一个键入的字符。

异步传输存在一个潜在的问题，即接收方并不知道数据会在什么时候到达。在它检测到数据并做出响应之前，第一个比特已经过去了。
这就像有人出乎意料地从后面走上来跟你说话，而你没来得及反应过来，漏掉了最前面的几个词。因此，每次异步传输的信息都以一个起始位开头，
它通知接收方数据已经到达了，这就给了接收方响应、接收和缓存数据比特的时间；在传输结束时，一个停止位表示该次传输信息的终止。
按照惯例，空闲（没有传送数据）的线路实际携带着一个代表二进制1的信号，异步传输的开始位使信号变成0，其他的比特位使信号随传输的数据信息而变化。
最后，停止位使信号重新变回1，该信号一直保持到下一个开始位到达。例如在键盘上数字“1”，按照8比特位的扩展ASCII编码，将发送“00110001”，
同时需要在8比特位的前面加一个起始位，后面一个停止位。

异步传输的实现比较容易，由于每个信息都加上了“同步”信息，因此计时的漂移不会产生大的积累，但却产生了较多的开销。
在上面的例子，每8个比特要多传送两个比特，总的传输负载就增加25%。对于数据传输量很小的低速设备来说问题不大，
但对于那些数据传输量很大的高速设备来说，25%的负载增值就相当严重了。因此，**异步传输常用于低速设备**。



2. 同步传输（Synchronous Transmission）：**同步传输的比特分组要大得多**。它不是独立地发送每个字符，每个字符都有自己的开始位和停止位，
**而是把它们组合起来一起发送**。我们将这些组合称为数据帧，或简称为帧。

数据帧的第一部分包含一组同步字符，它是一个独特的比特组合，类似于前面提到的起始位，用于通知接收方一个帧已经到达，
但它同时还能确保接收方的采样速度和比特的到达速度保持一致，使收发双方进入同步。

帧的最后一部分是一个帧结束标记。与同步字符一样，它也是一个独特的比特串，类似于前面提到的停止位，用于表示在下一帧开始之前没有别的即将到达的数据了。

同步传输通常要比异步传输快速得多。接收方不必对每个字符进行开始和停止的操作。一旦检测到帧同步字符，它就在接下来的数据到达时接收它们。
另外，同步传输的开销也比较少。例如，一个典型的帧可能有500字节（即4000比特）的数据，其中可能只包含100比特的开销。
这时，增加的比特位使传输的比特总数增加2.5%，这与异步传输中25 %的增值要小得多。
随着数据帧中实际数据比特位的增加，开销比特所占的百分比将相应地减少。但是，**数据比特位越长，缓存数据所需要的缓冲区也越大，这就限制了一个帧的大小。**
另外，**帧越大，它占据传输媒体的连续时间也越长。**在极端的情况下，这将导致其他用户等得太久。



同步传输方式中发送方和接收方的时钟是统一的、字符与字符间的传输是同步无间隔的。

异步传输方式并不要求发送方和接收方的时钟完全一样，字符与字符间的传输是异步的。



 同步与异步传输的区别

1,异步传输是面向字符的传输，而同步传输是面向比特的传输。

2,异步传输的单位是字符而同步传输的单位是桢。

3,异步传输通过字符起止的开始和停止码抓住再同步的机会，而同步传输则是以数据中抽取同步信息。

4,异步传输对时序的要求较低，同步传输往往通过特定的时钟线路协调时序。

5,异步传输相对于同步传输效率较低。


简单说　　同步传输就是，数据没有被对方确认收到则调用传输的函数就不返回。　　
接收时，如果对方没有发送数据，则你的线程就一直等待，直到有数据了才返回，可以继续执行其他指令　　
异步传输就是，你调用一个函数发送数据，马上返回，你可以继续处理其他事，　　接收时，对方的有数据来，你会接收到一个消息，或者你的相关接收函数会被调用。形象点说　　异步传输: 你传输吧，我去做我的事了，传输完了告诉我一声　　同步传输: 你现在传输，我要亲眼看你传输完成，才去做别的事

用于异步通信的连接在OSI(开放系统互连)参考模型的物理层中被定义。



“异步通信”是一种很常用的通信方式。

异步通信在发送字符时，所发送的字符之间的时间间隔可以是任意的。当然，接收端必须时刻做好接收的准备（如果接收端主机的电源都没有加上，那么发送端发送字符就没有意义，因为接收端根本无法接收）

。发送端可以在任意时刻开始发送字符，因此必须在每一个字符的开始和结束的地方加上标志，即加上开始位和停止位，以便使接收端能够正确地将每一个字符接收下来。

异步通信的好处是通信设备简单、便宜，但传输效率较低（因为开始位和停止位的开销所占比例较大）。



异步通信也可以是以帧作为发送的单位。接收端必须随时做好接收帧的准备。这时，帧的首部必须设有一些特殊的比特组合，使得接收端能够找出一帧的开始。这也称为帧定界。帧定界还包含确定帧的结束位置。这有两种方法。一种是在帧的尾部设有某种特殊的比特组合来标志帧的结束。或者在帧首部中设有帧长度的字段。需要注意的是，在异步发送帧时，并不是说发送端对帧中的每一个字符都必须加上开始位和停止位后再发送出去，而是说，发送端可以在任意时间发送一个帧，而帧与帧之间的时间间隔也可以是任意的。在一帧中的所有比特是连续发送的。发送端不需要在发送一帧之前和接收端进行协调（不需要先进行[比特同步](http://baike.baidu.com/view/3871099.htm)）。

位同步：

要求接收端根据发送端发送数据的起止时间和时钟频率，来校正自己的时间基准和时钟频率，这个过程叫位同步。可见，位同步的目的是使接收端接收的每一位信息都与发送端保持同步。



## 信道复用



## 带宽计算



## 传输速率的计算

有信噪比 - 香农定理计算最大传输速率

* * 直接给出信噪比x：y的形式，就直接带入S/N
  * 给出的单位是db，用x=10*log10(S/N)先计算出S/N

有信号代表的进制数、调制的状态数、无损信道 - NICE定理计算最大波特率（最大码元传输速率）

* * **如果告知是以太网（曼彻斯特编码），相当于告知波特率是比特率的二倍。**

**同时有信噪比和进制数，计算香农和NICE，取最小值。**

![image-20220605180550409](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605180550409.png)





## 编码和调制

1. 数字数据编码为数字信号
   * RZ 归零编码-有同步机制
   * NRZ 不归零-带宽利用高、不同步
   * NRZI - 遇到1保持，遇到0翻转，有同步机制和高带宽-**USB数据线**
   * 曼切斯特编码 - 同步，占用2倍带宽，**以太网**
   * 差分曼切斯特编码 - 同步，遇到1翻转，遇到0保持，**抗干扰能力好，局域网**

![image-20220615210032256](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615210032256.png)

1. 数字数据调制为模拟信号
   * ASk
   * FSK
   * PSK
   * QAM
2. 模拟数据编码为数字信号
   * 采样
   * 量化
   * 编码
3. 模拟数据调制为模拟信号
   * **声音的需要加载到模拟信号中传播**

![image-20220605180505023](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605180505023.png)



## 分组交换

采用数据报服务，可能出现失序、丢失、重复等问题，接受后还要进行排序，开销较大；采用虚电路服务没有哦失序问题，但是有建立、传输、释放三个过程。

**分组交换适合于突发事数据通信，因为不用向电路交换那样建立连接，不用像报文交换那样等整个报文完整收到后才能转发。**

* 数据报分组交换
  * 不可靠、不有序、**不进行流量控制**
  * 容错性高
* 虚电路分组交换
  * **面向连接**、可靠、**按序到达**、**有流量控制**
  * 分组：每个分组携带虚电路号，**不含目的地址，开销小**
  * 中间节点：虚电路表根据虚电路号进行转发，**同一虚电路的分组按照同一条路径转发**
  * 缺点：有一个节点出错整条电路就瘫痪了



## 分组交换计算

* 分组交换：可以流水并发
* 报文交换：必须等接受整个报文以后再转发，是顺序的
* 只有除了发送方和接收方的节点会存储转发
* 控制信息：源地址、目的地址等

![image-20220602182659259](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220602182659259.png)

1.分组转发是并行的，因此不需要考虑各个分组中间的延时，只需要考虑最后一个分组即可。

![image-20220605173644336](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173644336.png)

![image-20220605173616314](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605173616314.png)



2.

报文交换：发送方完整发出一个报文的时间+中间节点转发一个报文的时间

![image-20220605174413187](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605174413187.png)

分组交换：发送方发送完最后一个报文的时间+最后一个分组在中间节点转发的时间。

![image-20220605174221109](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605174221109.png)





## 中继器和集线器

1. 中继器
   * **信号再生**
   * 连接的是**网段**不是子网
   * **不能连接两个不同速率的局域网**
2. 集线器
   * 多端口中继器
   * **总线网络**
   * **双绞线搭建**
   * **半双工**
   * **不能分割冲突域**

1.

![image-20220605180149150](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605180149150.png)

2.

![image-20220605180158221](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605180158221.png)

3.

![image-20220605180237225](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220605180237225.png)



# 链路层

**功能：**

1. 向网络层提供两种服务
2. 加强比特流传输功能，相较于物理层更可靠
3. 封装成帧、帧定界、透明传输；流量控制；差错检验
4. **数据链路层提供点到点的可靠传输；传输层TCP提供端到端的可靠传输**



## **几种确定帧的方法**

* 字符计数法
* 首尾填充法
* * 比特填充的首尾标志法：填充01111110比特标志
  * 字符填充的首尾定界符法：使用特殊定界符
* 违规编码法：曼切斯特编码





## 差错控制方式

* 位错-CRC校验
* 帧错



## 流量控制-滑动窗口机制

* 窗口单位：**TCP层的窗口大小的单位是字节B（每个字节都有编号），而链路层滑动窗口大小的单位是帧（每个帧都有编号）**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615230230758.png" alt="image-20220615230230758" style="zoom:67%;" />

**可靠传输**

1.确认机制

* 链路层：ACKn代表确认n
* 传输层：ACKn代表确认n-1，希望收到n+1

2.重传机制(帧丢失、出错)

* 停等协议
* GBN
* SR



**停等协议**

发送间隔时间 = 数据发送完毕的时间 + 超时重传时间

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615231132630.png" alt="image-20220615231132630" style="zoom: 50%;" />





**后退N帧协议**

1.发送窗口大小：1-2^n-1。目的：避免接收方不发区分新帧和旧帧

2.可以连续发送，不需要每次都等待确认。

3.**丢失帧：后面的所有帧全部丢弃，并都返回出错前最后一个帧的确认ACK，直到一个超时时间后发送方重传丢失帧。**

**帧错误：发送方连续发送帧，在发送方发现帧出错以后，会从出错的那一帧开始重传后续所有帧**

4.当链路状态差时，效率甚至低于停等还差，因为丢弃了成功发送的帧，后面还要在发送一遍。

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615231949680.png" alt="image-20220615231949680" style="zoom:67%;" />

**SR选择重传协议**

1.发送窗口和接受窗口：2^(n-1)，目的：避免接受缓存接受重传的旧帧

2**.帧丢失**：接收方使用缓存接受丢失帧后面的帧，等到丢失的帧重传后整体确认

3.更好的**纠错机制**：接收方校验后发现出错，则给发送方发送一个NAK帧，发送方重传帧中指定的出错帧

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615233044210.png" alt="image-20220615233044210" style="zoom:67%;" />





1.随机差错可以通过提高信道利用率解决

![image-20220615214942053](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615214942053.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615215000167.png" alt="image-20220615215000167" style="zoom:67%;" />

**海明码的计算**

1.根据纠错还是检错的位数，计算海明距离

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615223849342.png" alt="image-20220615223849342" style="zoom:67%;" />

![image-20220615223920864](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615223920864.png)

2.校验位的个数计算                     

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615224040292.png" alt="image-20220615224040292" style="zoom:67%;" />

![image-20220615224108777](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615224108777.png)

**CRC校验和反校验过程**

![image-20220615225650739](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615225650739.png)



![image-20220615225633748](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220615225633748.png)

**窗口计算1**

* GBN有**累计确认机制**；GBN丢弃错误帧后面发送的所有帧，重传错误帧和其后面发送的所有帧。
* SR没有累计确认，乱序受到也会确认；SR只重传出错的帧。

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616204527234.png" alt="image-20220616204527234" style="zoom:50%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616204557553.png" alt="image-20220616204557553" style="zoom:50%;" />

**窗口计算2**

1. **概念：**
   * 传输时延：数据从发送方完全发出需要的时间；**发送的数据量/信道带宽** | 发送数据量/**数据传输速率**。一般忽略确认帧的传输时延。
   * **传播时延**：RTT，注意是单向还是双向
   * **平均数据传输率**：传输的总数据量/传输完毕所需要的时间。对于SR协议：一个帧的大小/一个帧的传输时间+RTT；对于GBN协议：n个帧的大小(整个发送窗口中帧的大小)/第一个帧的传输时间+RTT。
   * **信道利用率**、链路利用率：传输数据的时间/整个过程的时间；对于停等协议：(一个帧的大小/传输速率)/(一个帧的大小/传输速率)+RTT; 对于GBD协议：(n个帧的大小/传输速率)/(第一个帧的大小/传输速率)+RTT。**停等可以反求一个帧的大小，GBD协议可以反求帧编号需要的位数**；**注意：如果是捎带确认**，GBN协议的计算就是(n个帧的大小/传输速率)/(**两个帧的大小**/传输速率)+RTT





**【题目1】**甲和乙使用GBN传输数据，甲的发送窗口尺寸为1000，数据帧长为1000B，信道带宽为100Mb/s，乙每收到一个数据帧立即利用一个短帧（忽略其传输时延）进行确认，若甲、乙之间的单向传播时延是50ms，则甲可以达到的最大平均数据传输速率约为（80Mb/s）

![img](https://img-blog.csdnimg.cn/20200920183157233.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1ODEyMjA1,size_16,color_FFFFFF,t_70)

![img](https://img-blog.csdnimg.cn/20200920183225846.png)

**如果是捎带确认：**

![image-20220616230640401](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616230640401.png)

* **GBN信道利用率 = (2^n-1)* 停等协议信道利用率**
* **SR信道利用率 = 2^(n-1)* 停等协议信道利用率**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616232500932.png" alt="image-20220616232500932" style="zoom:50%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616204818278.png" alt="image-20220616204818278" style="zoom:50%;" />

![image-20220616210238704](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616210238704.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616204851548.png" alt="image-20220616204851548" style="zoom:67%;" />

![image-20220616204936235](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616204936235.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616205004546.png" alt="image-20220616205004546" style="zoom:67%;" />

**窗口计算3**

* SR协议满足两个限制：
* * 发送窗口 <= 2(n-1)
  * **发送窗口+接受窗口 <= 2^n**
  * 一般情况发送窗口=接受窗口

![image-20220616205027178](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220616205027178.png)



## 复用

* 频分复用（两个车道），**信道利用率高**，模拟信号（宽带）
* 时分复用，利用率低，数字信号（基带）
* 码分复用（共享时间和空间，整体运输黄豆和绿豆，最后一起分开）
* 波分复用（光纤传输）

![image-20220617212919670](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617212919670.png)

## 介质访问控制

**即便是广播，也可以通过访问控制协议限制为点对点的传送，所以链路层是点对点的**

* **信道划分**

* * 信道复用技术：波分、码分、时分、频分

* **随机访问**

* * 纯Aloha
  * 时隙Aloha
  * CSMA
  * **CSMA/CD（有线以太网）**
  * CSMA/CA（无线局域网）

* **轮询**

* * 令牌环域网

  * 适用于**负载很多**的广播网

    

    <img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617193608453.png" alt="image-20220617193608453" style="zoom:67%;"/>

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617193946980.png" alt="image-20220617193946980" style="zoom:67%;"/>

* 1-坚持CSMA：**信道忙**持续监听，**空闲**立即发送（同时立即发送的冲突问题），**冲突后随机时间再监听（二进制指数退避算法）**
* p-坚持CSMA：信道忙持续监听，空闲概率p发送（不会等待过长的随机事件，降低冲突概率，折中）
* 非坚持CSMA：信道忙后随机时间后监听，空闲立即发送（随机事件等待太长的问题）

![image-20220617194548595](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617194548595.png)



**CSMA/CD**

* 在1-坚持CSMA的基础上增加了冲突避免：如果发送过程中遇到冲突，发送方就立即停止发送，此时已经发送的残缺数据将会被丢弃。因为传输延迟而没有检测到信道被占用，就会可能有多个发送方发送数据，此时监听信道是失效的，因此需要冲突避免来解决监听失效，保证整个信道只有传输一个发送方的数据时才是可用的，传送多个发送方的数据时这些数据都是残缺的。因此需要设置最小帧长，为的就是确保只要信道中有多个发送方同时发送数据，在碰撞后立即停止发送，此时发送出去的数据时不完整的，接收方就算收到也会丢弃。碰撞后需要一个随机事件再次监听后发送，此时采用二进制指数退避算法。

1. **适用于总线型网络和半双工网络**（以太网因此有最小帧长）
2. 最小帧长 = **最远的两个端点之间**往返的时间 * 发送速率
3. 二进制指数退避算法：**争用期时间*(2^k - 1)**，k是重传次数，随着重传次数的增加，发送方随机等待的时间是指数倍的往返时间。k大于10以后都按照10计算，即最大等待时间是争用期\*(2^10-1)，当k为16时认为网络拥挤无法发送。

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617201114878.png" alt="image-20220617201114878" style="zoom:50%;" />

![image-20220617213118994](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617213118994.png)

![image-20220617213712707](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617213712707.png)



![image-20220617213957175](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617213957175.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617214008773.png" alt="image-20220617214008773" style="zoom:80%;" />



* 两台主机均检测冲突：

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617224329687.png" alt="image-20220617224329687" style="zoom:67%;" />

* 有效数据传输率：以太网有效数据是46-1500B，其他18B是控制信息

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617224034929.png" alt="image-20220617224034929" style="zoom:80%;"/>

以太网：曼切斯特编码、CSMA/CD

局域网：差分曼切斯特、CSMA/CA

**CSMA/CA**

**尽量**避免冲突产生

* 用于无线局域网
* * 隐蔽站问题
  * 信号强度问题
* **预约信道**：提前告知，在我发数据的过程中不要有其他人发
* **ACK帧**
* RTS（解决隐蔽站）



## 局域网



### 以太网

* **无连接、不编号、不确认**
* 逻辑拓扑：总线型；物理拓扑：星型
* **以太网是基带传输**，传输数字信号，可以用**中继器**再生信号。
* 以太网支持广播，**每台计算机都要处理广播信息**，但是因为是无确认无连接的，因此可以减少一些广播带来的处理损耗。
* 快速以太网：
* * **保持最短帧长不变，减少传输距离**
  * 使用**集线器**hub而非同轴电缆
* **同轴电缆：50欧姆基带电缆，75欧姆宽带电缆**

![image-20220617230810117](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220617230810117.png)

![image-20220618084621026](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618084621026.png)

* LLC：向网络层提供：无确认无连接、有确认无连接、有连接、高速传输四种服务。**给帧加序号**。
* MAC：**封装帧解封装、差错检验。透明传输**、流量控制



###  广域网

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618090545803.png" alt="image-20220618090545803" style="zoom:80%;" />

* PPP：异步+字符填充；同步+0比特填充。拨号连接，动态分配IP。
* HDLC：0比特填充（位填充）



## 设备

* 网桥
* * 链路层的MAC子层，无法实现流量控制，因为编号是在LLC子层
  * **隔离冲突域，不隔离广播域**，设备太多会有广播风暴
  * **连接不同网段**，与局域网相连
  * 透明网桥的自学习算法
  * 存储转发

* 交换机（速度更快）
* * 多端口网桥
  * 全双工，并发通信
  * 直接与主机相连接
  * 存储转发（不同速率互联）、**直通式（速度快）**
  * 构成虚拟局域网VLAN，**隔离冲突域和广播域**

![image-20220618095659003](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618095659003.png)

如下图，两个设备对于发送出去的广播帧都不能隔离，要把广播帧发给所有设备。但是对于反过来发送的确认帧，Hub集线器不能隔离，而交换机可以根据交换表动态选择一个转发端口。

![image-20220618092207348](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618092207348.png)



**网桥自学习**

1. 网桥遇到没见过的源地址，就记录其传入端口和地址
2. 网桥遇到没见过的目的地址，就广播到其他设备
3. 网桥遇到见过的源地址，**就更新一下计时器**
4. 网桥遇到见过的目的地址，只转发或丢弃，不会再广播了（视情况分析）
5. **一段时间计时后，表项如果不更新就会被删除**
6. 拿出源地址，记录or更新**计时器**
7. 拿出目的地址，转发or广播扩散or丢弃

![image-20220618094438600](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618094438600.png)



# 网络层

**网络层：ICMP、ARP**

**传输层：NAT转换、DHCP(UDP)**

**应用层：RIP(UDP)**



**功能：异构网络互联、路由和分组转发、拥塞控制**

* 异构：物理层不同（传输介质、编码方式），链路层不同（链路控制、数据单元格式）
* 互联：物理、数据链路、网络层协议都可以不同，网络层以上协议相同。IPV4和IPV6就是不同网络层协议的互联。
* 路由：确定走那一条路径；路由表；路由算法；层次划分

* 网络层拥塞控制：开环控制（初始写好控制策略），闭环控制（检测并获取拥塞发生信息，传递到合适的地方进行并以此调整，**发送ICMP源点抑制报文，减缓发送方发送速率**）。
* 随着网络负载的增加，网络吞吐量减小
* 单一增加资源不能解决拥塞





## 距离矢量、链路状态、路径向量

* 分层次路由：
* * 随着网络个数增加，路由器路由表开销太大，因此分为多个自治系统，每个自治系统内有多个局域网，对于OSPF算法来说自治系统再划分为多个区域，每个路由器只需要知道区域内的转发路径即可。
  * 内部网关协议IGP：RIP、OSPF
  * 外部网关协议EGP：BGP，不同自治系统之间的路由器交换信息，不同自治系统间路由

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618190812998.png" alt="image-20220618190812998" style="zoom: 50%;" />

* RIP协议
* * 基于路径向量算法
  * 每个路由器拥有：**自身节点到其他所有节点**的距离记录。**对于RIP：距离=跳数=TTL减少值**，距离不一定是跳数。
  * **只和相邻路由交换信息**
  * 规定跳数的目的：避免回路循环(因为收敛慢)
  * 动态，每30s**广播**更新一次信息
  * 过程：S收到来自相邻路由的路由表，对于来自X的路由表，首先将S的下一跳改为S，然后将S中的路径信息+1，对比S原来的表项，如果原来没有表项就直接填入，如果原来表项的下一跳地址也是X，则直接覆盖更新，如果原来表项的下一跳不是X, 就比较选取最小的那个（保留or覆盖）。**本质就是计算S->X + X->其他的过程，然后和以前的比较，用距离较小的当转发地址。**当180s未更新，则认为**网络故障，距离改为16**
  * 缺点：最大距离15限制了网络规模； 坏消息收敛慢； 交换整张路由表，开销大,； 路径不一定最短，只是跳数最少。
  * **应用层协议, UDP520**
* OSPF

* * **链路状态**
  * 知道局部链路状态信息
  * 通过**0**机制和整个自治系统的路由器交换信息
  * **基于Dijkstra算法计算最小路径**
  * 结合层次路由适用于**大规模网络**，**OSPF将自治系统再次划分为区域，每次泛洪限制在区域内，减少整个网络的通信量，**一个区域内的路由只知道本区域内的完整网络拓扑。
  * **网络层协议IP**
  * 最终每个节点都知道整个网络的拓扑结构
  * **链路变化时重新泛洪，重新使用Dijistra计算**
* BGP
* * **目的：自治系统间路由**
  * **路径向量**
  * **应用层，TCP**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618192900763.png" alt="image-20220618192900763" style="zoom:80%;" />



**计算1：距离向量算法的状态更新**

* C收到B、E、D发来的向量信息，这些信息本质上就是B-其他的距离、D-其他的距离、E-其他的距离，分别计算：C-B+B-其他；C-D+D-其他；C-E+E-其他的向量信息，然后去每一项中最小的哪一个作为最终转发的信息。
* <img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618154418557.png" alt="image-20220618154418557" style="zoom:33%;" />
* 注意：A->B的延迟和B->A的延迟不一样。

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618153829284.png" alt="image-20220618153829284" style="zoom:50%;" />

* **距离向量收敛慢导致的问题**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618155448136.png" alt="image-20220618155448136" style="zoom:67%;" />

​	**坏消息收敛慢导致出现错误的路径或出现回路。当R1与网络1通时，R1内到网络1的距离为16，但是此时R2因为还没更新所以到网络1的距离是2，这就导致下次R1到网络1时会先选择到R2，陷入循环。**

<img src="https://img-blog.csdnimg.cn/20200924155700673.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1MjU1MjU3,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述" style="zoom:67%;" />

* RIP协议路由表的更新：新的、旧的、失效的

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203330951.png" alt="image-20220618203330951" style="zoom: 67%;" />

![image-20220618203354808](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203354808.png)

* OSPF链路状态路由表更新：直接只用Dijistra获得最短路径，然后计算路径值

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203407690.png" alt="image-20220618203407690" style="zoom:67%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203419866.png" alt="image-20220618203419866" style="zoom:50%;" />

* BGP计算路由表：两个自治区域间的就是BGP

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203441560.png" alt="image-20220618203441560" style="zoom:67%;" />



* OSFP+CIDR计算路由表

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203458859.png" alt="image-20220618203458859" style="zoom:67%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203525785.png" alt="image-20220618203525785" style="zoom:67%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203540557.png" alt="image-20220618203540557" style="zoom:67%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618203555068.png" alt="image-20220618203555068" style="zoom:67%;" />



## IPV4

* **广播地址：只能作为目的地址；0.0.0.0：只能最为源地址**

* 中间路由分片、目的主机合并

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619085304851.png" alt="image-20220619085304851" style="zoom: 50%;" />

* IP在路由上传输的过程中，IP地址始终不变，MAC地址始终变化，即不断拆封再封。NAT路由的源IP地址也会变化。

* **127.0.0.1环路自检**，**任意主机本身**
* 255.255.255.255全网广播，但是因为路由隔离广播域所以变成本网络广播，**只能目的地址。**
* xxxxxx.255 本网络广播
* **0.0.0.0 本网络的本主机 ，只能源地址**
* 主机号全0，本网络

![image-20220619100948075](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619100948075.png)

## ARP/ICMP/DHCP

* ARP：**网络层**，IP-MAC
* ICMP：差错检验；差错报告，**PING是应用层**
* DHCP：动态IP分配，**应用层**



## NAT转换、子网划分、子网掩码、CIDR

* NAT、子网划分+掩码减缓了传统划分方法地址不够用的情况
* CIDR、CIDR+子网掩码减少了路由表项开销，聚合超网

### NAT

![image-20220618234506606](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220618234506606.png)

### 子网划分+子网掩码

对于子网划分，首先先看子网掩码，如下子网掩码是未划分时的子网掩码：

1. 255.0.0.0 A 类
2. 255.255.0.0 B类
3. 255.255.255.0 C类

如果子网掩码和这个不一样，就代表对传统ABC类网络进行了子网划分。看一下子网掩码1的个数，判断有多少主机号被划分为子网号，例如一共8位主机号，现在子网划分后变为3位子网号和5位主机号，即有001,010,011,100,101,110六个子网，每个子网内的主机号为00001-11110，注意网络号和主机号都不能全为0或1.

* 划分子网：**减少广播域和冲突域，**减少每个子网的主机数，**网络数量保持不变。**

![image-20220619083930732](https://cdn.jsdelivr.net/gh/hanfeijiang/CS-Sources/img/image-20220619083930732.png)



![image-20220619133034646](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619133034646.png)

![image-20220619133246623](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619133246623.png)





### CIDR

* CIDR：不用传统的ABC分类，可以灵活分类
* 每个CIDR地址都对应一个掩码：xx.xx.xx.xx/20 对应的掩码就是 20 个1
* CIDR + 子网划分： 初始已知一个CIDR地址，通过斜线后面的数字得到网络号位数，进而得到主机号位数，把主机号进行分割即可，一部分和原来的网络号合并，一部分保留为主机，**注意如果是求分配的地址范围，则主机号不能为全0和全1.**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619085848279.png" alt="image-20220619085848279" style="zoom:80%;" />

* 初始时如果CIDR的子网掩码和网络号对于位数一致，代表没有进行子网划分。此时可以随意划分，但是主机号至少有2位，即2个有效地址。
* 如果初始CIDR和子网掩码就不一样，则可以用子网掩码进行子网划分。

![image-20220619090603393](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619090603393.png)



**CIDR子网划分计算**

* CIDR子网划分时网络号可以为全0和全1

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619093953958.png" alt="image-20220619093953958" style="zoom:80%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619094013308.png" alt="image-20220619094013308" style="zoom: 67%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619095207506.png" alt="image-20220619095207506" style="zoom:67%;" />





**CIDR路由表路由**

* 匹配所有表项的子网掩码，取网络号最长的转发
* 都不匹配就转发0.0.0.0/0默认网关
* **表项x.y.z.w/32 即子网掩码全为1，没有聚合超网，单一网络转发**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619131728619.png" alt="image-20220619131728619" style="zoom:80%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619133359402.png" alt="image-20220619133359402" style="zoom:67%;" />





## 路由表的计算

* 如果是子网划分的：同一网络多个子网的多个目的IP地址的子网掩码可以一致。
* 没有划分子网，子网掩码就是默认子网掩码

![image-20220619124951042](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619124951042.png)

![image-20220619125006579](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220619125006579.png)







# 传输层

1.seq和ask的含义，传输数据时的变化

* Seq标识数据段起始字节的编号
* ACK标识下一个想要的需要

2**.阻塞窗口随着发送次数的计算**

3.MSS的含义



1.

![image-20220612173157290](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220612173157290.png)

2.

![image-20220612173236112](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220612173236112.png)







## 三次握手和四次握手



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220612174855718.png" alt="image-20220612174855718" style="zoom:80%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220612174913766.png" alt="image-20220612174913766" style="zoom:67%;" />



**ACK和Seq的计算**

1. **初始比特的序号+段长度 = ACk**
2. **seq是等于对方的ACK；ACK是对方的seq+1**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170045540.png" alt="image-20220614170045540" style="zoom:50%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170231350.png" alt="image-20220614170231350" style="zoom:50%;" />

![image-20220614170521304](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170521304.png)





## 拥塞控制

* 图中是拥塞窗口的变化，不是发送窗口的变化
* 发送窗口=min{拥塞窗口，接受窗口}
* * 当接收方缓存只放入不读出时，极有可能导致发送窗口受限于接受窗口
* 一个**RTT**代表一个间隙，即1-2,2-4,4-8,8-16就是4个RTTs
* **收到确认**：代表拥塞窗口增长；代表得到了接受窗口的大小
* **MSS**：一个窗口大小的数据；初始第一次发送的数据量
* **慢启动门限**: 增长不能超过这个门限，如果超过的就按照这个门限的大小算
* **拥塞窗口为x时发生超时/收到三个ACK**：下一次的慢启动门限变为x/2

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614164944552.png" alt="image-20220614164944552" style="zoom:67%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614164958792.png" alt="image-20220614164958792" style="zoom:67%;" />



**计算拥塞窗口或阻塞窗口**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170204099.png" alt="image-20220614170204099" style="zoom:50%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170608714.png" alt="image-20220614170608714" style="zoom:67%;" />



<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170640132.png" alt="image-20220614170640132" style="zoom:67%;" />



**计算最大吞吐量**

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614170951304.png" alt="image-20220614170951304" style="zoom:80%;" />

* 最大吞吐量=20ms内发完64KB数据，单位是b/s

* 带宽：最大的传输速率 bps
* 吞吐量：某时刻的传输速率 bps
* 传输速率：单位时间流过的数据量 bps

**计算新的平均RTTs**

* 设计一个更新权重

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614172646590.png" alt="image-20220614172646590" style="zoom:80%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614172707863.png" alt="image-20220614172707863" style="zoom:67%;" />



**TCP最大传输率的计算***

![image-20220614181253928](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614181253928.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614181234353.png" alt="image-20220614181234353" style="zoom:67%;" />

https://blog.csdn.net/PriceCheap/article/details/124789549

* TCP滑动窗口确认的是单个报文段，每发送一个报文段就确认一次，类似GDN协议
* 对报文段的确认实质上是对比特流的累积确认
* 对于发送到接收方的数据，如果丢失就不接受后续的报文段了，直接连续返回缺失的ACK，这是GBN的协议；SR协议能够缓存乱序和其他帧，等丢失的帧到来后一起发送。
* GBN这种累积确认+丢失后反复重传ACK不接收其他数据段的类型：窗口最大2^n - 1，如果窗口等于2^n有最坏情况，即所有ACK都丢失时接收方接受了发送方传来的旧数据（实际上已经接收过了这些数据）。
* SR这种缓存数据+重传ACK的类型：窗口最大2^(n-1)，避免最坏情况下发送方发送的旧数据接收方依然可以接受。
* TCP是GBN类型的，因此最大发送的数据量应该受限于编号大小，n位序号最多一次性发送2\^n-1个帧，即发送窗口最大为2^n-1

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614175743924.png" alt="image-20220614175743924" style="zoom: 33%;" />





![image-20220614182346525](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614182346525.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614182333137.png" alt="image-20220614182333137" style="zoom:67%;" />



**线路利用率计算**

* 带宽、吞吐量、吞吐率都是速率的概念**，G=10^9, M = 10^6,K = 10^3**
* 线路效率 = 吞吐/带宽
* **端到端时间 * 2= RTT** （大坑）

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614181348179.png" alt="image-20220614181348179" style="zoom:80%;" />



**综合问题**

1. 拥塞窗口在指数上升阶段1-2-4-8-16-32的变化并非一次的跳跃，而是多次累积+1的结果。每次收到一个确认段就将阻塞窗口+1，第二问中的第8个确认段应该是第4次发送的8个报文段中的第1个段的确认段，收到这个确认段口阻塞窗口变为9.
2. 接受缓存的变化是20K-19K-17K-13K-5K-0K，对应发送窗口的变化是1-2-4-8-5-0，经过5个RTT后接受窗口变为0，在此期间一共发送了20KB的数据。
3. 序号标识的比特，因此20KB=20*2^10b, 对应序号就是101+20\*2^10
4. 最后考的是四次握手有几个RTT，因为服务器S不需要再向客户端传送数据，因此实际上只有1.5个RTT

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614203405033.png" alt="image-20220614203405033" style="zoom:67%;" />



1. **什么时候以太网需要填充？ 总长度小于以太网最小长度46B时**。通过比较IP的总长度部分，进而知道是否需要填充
2. 如何计算发送的总数据量？**最后一个数据段的ack -  第一个数据段的seq**

![image-20220614210420378](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220614210420378.png)





# 应用层

## DNS域名解析

1. DNS请求是**UDP数据报**，客户端向本地域名服务器发送请求

* 今后的查询都是本地域名服务器进行的

  * **本地域名服务器先查看本地缓存**

  * 递归查询：本地域名服务器向根域名服务器发起一次请求，后续请求都是由其他服务器发起的。
  * 迭代查询：本地域名服务器发起多次请求，直到在一个权限域名服务器那里得到解析好的IP
  * **查询成功后将IP存在本地域名服务器的缓存里**

2. 根域名服务器：不存放任何解析的IP，只用来查找顶级域名
3. 顶级域名：com、cn
4. 权限域名：abc.com
   * 一台主机可有多个权限域名服务器
   * 每台主机都要在权限域名服务器上登记
   * 权限域名服务器总能将主机的域名转换我主机的IP地址

![image-20220606125828709](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606125828709.png)



1.域名和IP、MAC、主机都不是一一对应关系。

![image-20220606125910243](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606125910243.png)

2.DNS和NAT技术

![image-20220606125934506](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606125934506.png)

3.本地主机只需要知道本地域名服务器再哪即可，其他的都是本地域名服务器该操心的。

![image-20220606130033306](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606130033306.png)

4.**根域名服务器啥都不是**，com和cn是顶级域名

![image-20220606130045471](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606130045471.png)

![image-20220606130239421](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606130239421.png)



5.

![image-20220606130255666](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606130255666.png)



## FTP

**1.FTP的控制信息是带外传送的**

2.控制连接在整个会话期间都是打开的

**3.发送控制信息例如FTP命令时：服务器21端口**

**4.发送文件数据如文件列表是：服务器20端口**

注意：20和21都是服务器的端口，客户端的端口是堆积分配的

![image-20220606130645570](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606130645570.png)

![image-20220606131140036](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606131140036.png)





## 邮件

1. **To和Subject是发件人自己确定的**，From和发送时间可以服务器自己解析

![image-20220606131859710](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606131859710.png)

2. SMTP

   * **只能传送一定长度的ASCII码**（MIME可改进）
   * **服务器端口25**
   * TCP直接连接两个邮件服务器

3. POP

   * TCP连接

   * CS模式
   * 端口110

4. Gmail和Hotmail，使用浏览器发送，**基于HTTP**

5. 接收方的协议：POP、**HTTP、IMAP**

![image-20220606132226539](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220606132226539.png)

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220620001345647.png" alt="image-20220620001345647" style="zoom:50%;" />

<img src="C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220620001356158.png" alt="image-20220620001356158" style="zoom:80%;" />





## HTTP

![image-20220620132140940](C:\Users\29185\AppData\Roaming\Typora\typora-user-images\image-20220620132140940.png)
